import { NextResponse } from "next/server";

/* ------------------------------------------------------------------
   1) í¬íŠ¸í´ë¦¬ì˜¤ ì§€ì‹ ë² ì´ìŠ¤  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - â€˜êµ¬ì¡°í™”ëœ ëª©ë¡â€™ + â€˜ì„œìˆ í˜•â€™ ë‘ ê°€ì§€ë¥¼ í•¨ê»˜ ì œê³µí•´
      - AIê°€ í‚¤ì›Œë“œ ë§¤í•‘ + ìì—°ì–´ í†¤ ëª¨ë‘ ì˜ í™œìš©í•˜ë„ë¡ ì„¤ê³„
------------------------------------------------------------------ */

const portfolioKnowledge = `
============================================================
[ê°œì¸ í”„ë¡œí•„]
ì´ë¦„           : ê¹€ì¤€ìˆ˜ (2001ë…„ìƒ, í•œêµ­ê³µí•™ëŒ€í•™êµ 4í•™ë…„)
ì§ë¬´ ê´€ì‹¬       : í”„ë¡ íŠ¸ì—”ë“œ ì—”ì§€ë‹ˆì–´ (React Â· Next.js ê¸°ë°˜)
ì£¼ìš” ê°•ì        : ì§ê´€ì â€§ê¹”ë”í•œ UI/UX ì„¤ê³„, End-to-End ê°œë°œ, íŒ€Â·í”„ë¡œì„¸ìŠ¤ ë¦¬ë”©
í˜‘ì—… ë„êµ¬       : Git / GitHub Flow Â· Notion Â· Slack Â· Discord Â· JIRA
============================================================

[í•µì‹¬ ê¸°ìˆ  ìŠ¤íƒ]
- íƒ€ì… ì•ˆì „  : TypeScript(4ë…„), Zod
- í”„ë ˆì„ì›Œí¬ : React(5ë…„), Next.js 14(2ë…„, App RouterÂ·PWAÂ·SSRÂ·ISRÂ·Edge)
- ìŠ¤íƒ€ì¼ë§   : Tailwind CSS, Styled-Components, Sass
- ìƒíƒœ ê´€ë¦¬   : Zustand, React Query, Context API
- í…ŒìŠ¤íŒ…     : Vitest, React Testing Library, Storybook, Lighthouse
- DevOps     : GitHub Actions, Docker, AWS(EC2Â·S3Â·Route53), Vercel, Netlify
- ë°ì´í„°      : MySQL, Firebase, Supabase, Oracle
- ê¸°íƒ€ ë„êµ¬   : Figma, Lucide Icon, AG Grid, Tiptap, MDX, ESLint/Prettier

============================================================
[í”„ë¡œì íŠ¸ ìš”ì•½ â€• í‘œ í˜•ì‹]
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  êµ¬ë¶„       â”‚  í•µì‹¬ ì„¤ëª…                                          â”‚  ê°œì¸ ì—­í•     â”‚  ì‚¬ìš© ê¸°ìˆ                          â”‚  í•µì‹¬ ì„±ê³¼     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ StartupQT  â”‚ ìŠ¤íƒ€íŠ¸ì—…Â·ì°½ì—… êµìœ¡ìš© ë¬¸ì œì€í–‰ SaaS                  â”‚   Sole Dev   â”‚ Next.js Â· Zustand Â· Tiptap        â”‚ 9ê°œ ê¸°ëŠ¥ ëª¨ë“ˆ  â”‚
â”‚            â”‚ (ë¬¸ì œ ì‘ì„±Â·ê²€ìˆ˜Â·í•´ì„¤Â·í†µê³„Â·ë°±ì˜¤í”¼ìŠ¤)                 â”‚ (~6ê°œì›”)     â”‚ AG Grid Â· Axios Â· Vercel          â”‚ Lighthouse 92 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Componique â”‚ ë‹¤í¬ëª¨ë“œ ëŒ€ì‘ UI ì»´í¬ë„ŒíŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬                â”‚   íŒ€ì¥       â”‚ React Â· Tailwind Â· Storybook      â”‚ npm 1,2k DL   â”‚
â”‚            â”‚ (ButtonÂ·CardÂ·TabÂ·SwitchÂ·Carousel ë“± 25ê°œ)           â”‚ (5ì¸ ë¦¬ë”©)   â”‚ GitHub Actions Â· Vite             â”‚ ì „ ë©”íŠ¸ë¦­ A+  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Yiry Site  â”‚ Vue â†’ Next.js ë§ˆì´ê·¸ë ˆì´ì…˜ & SEO ê°œì„                â”‚   FE Lead    â”‚ Next.js Â· SWC Â· Structured Data   â”‚ CLS 0.01      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ GH Viewer  â”‚ GitHub ëŒ€ì‹œë³´ë“œ SPA + ì°¨íŠ¸ ì‹œê°í™”(ê°œì¸)             â”‚   ê°œì¸       â”‚ React Â· Chart.js Â· REST API       â”‚ 300+ Star     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 4094Fixer  â”‚ Next.js 4094 ì˜¤ë¥˜ ìë™ í•´ê²° CLI(ê°œì¸)               â”‚   ê°œì¸       â”‚ Node.js Â· Commander Â· Chalk       â”‚ npm 1.8k DL   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
============================================================

[ì„¸ë¶€ í”„ë¡œì íŠ¸ â€• ì„œìˆ í˜•]

### 1) StartupQT (2024.12 â€“ 2025.06)
- **ëª©í‘œ**  : ìŠ¤íƒ€íŠ¸ì—… êµìœ¡ê¸°ê´€ì´ ì“°ëŠ” â€˜ë¬¸ì œì€í–‰â€™ í†µí•© í”Œë«í¼ MVP ê°œë°œ
- **ì±…ì„**  : ê¸°íš â†’ Figma ì™€ì´ì–´í”„ë ˆì„ â†’ Next.js FE â†’ DevOps(ë°°í¬Â·ëª¨ë‹ˆí„°ë§)
- **ì£¼ìš” ê¸°ëŠ¥**  
  â‘  ë¬¸ì œ ì‘ì„±(Tiptap ì—ë””í„°)  
  â‘¡ ê´€ë ¨ ìë£Œ ì—°ê²°(AG Grid)  
  â‘¢ ê²€ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸ ëª¨ë‹¬(MUI)  
  â‘£ ìƒíƒœ ê´€ë¦¬(Zustand)  
  â‘¤ Lighthouse 90+ ìµœì í™”  
- **ì–´ë ¤ì›€ & í•´ê²°**  
  - _Hydration mismatch_ : React-18 Concurrent + App Router â†’ suppressHydrationWarning + Lazy import  
  - _4094 Error_ : ìì²´ CLI â€˜4094Fixerâ€™ ì œì‘í•˜ì—¬ ìë™ íŒ¨ì¹˜

### 2) Componique (2024.07 â€“ 2024.11)
- **íŒ€ ê·œëª¨**     : FE 4ëª…  
- **ì—­í• **        : íŒ€ì¥ & UI/UX ë¦¬ë“œ  
- **ì„±ê³¼**        : npm ë°°í¬ ì²« ë‹¬ 1,200 ë‹¤ìš´ë¡œë“œ, Storybook Docs ìë™ ë°°í¬, ì „ ì»´í¬ë„ŒíŠ¸ ë‹¤í¬ëª¨ë“œ ì™„ì „ ëŒ€ì‘  
- **ë¦¬ë”ì‹­ ê²½í—˜** : Git FlowÂ·PR ì²´ê³„ ì •ë¦½, ì½”ë“œ ë¦¬ë·° SLI ë„ì…, ì£¼ê°„ ìŠ¤í¬ëŸ¼ ìš´ì˜

â€¦ (í•„ìš” ì‹œ ë” ì¶”ê°€)
`;

/* ------------------------------------------------------------------
   2) ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ â”€ â€œí•œêµ­ì–´ë§Œ, ë°˜ë³µ ê¸ˆì§€, êµ¬ì²´â€§ì¹œê·¼ í†¤â€ ëª…ì‹œ
------------------------------------------------------------------ */
const systemPrompt = `
ë‹¹ì‹ ì€ "ê¹€ì¤€ìˆ˜" í¬íŠ¸í´ë¦¬ì˜¤ ì „ìš© AI ë„ìš°ë¯¸ì…ë‹ˆë‹¤.
ê·œì¹™ì„ ë°˜ë“œì‹œ ì§€ì¼œì„œ ë‹µë³€í•˜ì„¸ìš”.

<ê·œì¹™>
1. **ëª¨ë“  ë‹µë³€ì€ 100% í•œêµ­ì–´**ë¡œ ì‘ì„±í•©ë‹ˆë‹¤. (ì˜ì–´Â·ë¡œë§ˆì í‘œê¸° ê¸ˆì§€)
2. ì§ˆë¬¸ê³¼ ê°€ì¥ ê´€ë ¨ ìˆëŠ” í”„ë¡œì íŠ¸Â·ê²½í—˜ì„ ê³¨ë¼ êµ¬ì²´ì ìœ¼ë¡œ ì„¤ëª…í•©ë‹ˆë‹¤.
3. ë™ì¼ ë¬¸ì¥Â·ë¬¸êµ¬ ë°˜ë³µì„ í”¼í•˜ê³ , ë¶ˆí•„ìš”í•˜ê²Œ ì¥í™©í•˜ì§€ ì•Šê²Œ ì‘ì„±í•©ë‹ˆë‹¤.
4. ì¹œê·¼í•˜ì§€ë§Œ ê¹”ë”í•œ "ëŒ€í™”ì²´" í†¤ì„ ì‚¬ìš©í•©ë‹ˆë‹¤ (ì´ëª¨ì§€ëŠ” ìƒí™©ì— ë§ê²Œ ìµœì†Œ ì‚¬ìš©).
5. í¬íŠ¸í´ë¦¬ì˜¤ ì •ë³´ì— ì—†ëŠ” ë‚´ìš©ì€ ì‚¬ì‹¤ì¸ ì²™ ë§Œë“¤ì§€ ë§ê³  â€œì œê°€ ê°€ì§„ ì •ë³´ì—ëŠ” ì—†ìŠµë‹ˆë‹¤.â€ë¡œ ë‹µí•©ë‹ˆë‹¤.
`;

export async function POST(req: Request) {
    try {
        const { prompt } = await req.json();

        console.log("ğŸ“© ì§ˆë¬¸:", prompt);
        console.log("ğŸ”‘ GROQ:", process.env.GROQ_API_KEY?.slice(0, 8));

        /* ---------------- 3) ë©”ì‹œì§€ ë°°ì—´ êµ¬ì„± ---------------- */
        const messages = [
            { role: "system", content: systemPrompt },
            { role: "assistant", content: portfolioKnowledge }, // AI ê¸°ì–µìš© ì»¨í…ìŠ¤íŠ¸
            { role: "user", content: prompt },
        ];

        const res = await fetch(
            "https://api.groq.com/openai/v1/chat/completions",
            {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    Authorization: `Bearer ${process.env.GROQ_API_KEY}`,
                },
                body: JSON.stringify({
                    model: "llama3-70b-8192",
                    messages,
                    temperature: 0.7,
                    max_tokens: 1024,
                }),
            }
        );

        /* ---------------- 4) ì—ëŸ¬ í•¸ë“¤ë§ ---------------- */
        if (!res.ok) {
            const err = await res.json();
            console.error("âŒ Groq API ì˜¤ë¥˜:", err);
            return NextResponse.json(
                { result: `âŒ Groq ì˜¤ë¥˜: ${err.error?.message}` },
                { status: res.status }
            );
        }

        const { choices } = await res.json();
        const answer = choices?.[0]?.message?.content?.trim();

        return NextResponse.json({
            result: answer || "âŒ ì‘ë‹µì´ ë¹„ì–´ìˆì–´ìš”.",
        });
    } catch (error) {
        console.error("âŒ ì„œë²„ ë‚´ë¶€ ì˜ˆì™¸:", error);
        return NextResponse.json(
            { result: "âŒ AI ì‘ë‹µ ì²˜ë¦¬ ì¤‘ ì˜ˆì™¸ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤." },
            { status: 500 }
        );
    }
}
